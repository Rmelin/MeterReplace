{% if inline %}
    <div class="inline-edit-panel">
        <h3>Rediger opgave</h3>
        {% if address %}
            <p class="hint">{{ address.street }} {{ address.house_no }}, {{ address.zip }} {{ address.city }}</p>
        {% else %}
            <p class="hint">Opgave uden adresse</p>
        {% endif %}
        {% if errors %}
            <div class="inline-errors">
                {% for error in errors %}
                    <div>{{ error }}</div>
                {% endfor %}
            </div>
        {% endif %}
        <form method="post" action="/admin/appointments/{{ appointment.id }}/edit" class="form-grid" data-inline-edit-form data-duration-form>
            <input type="hidden" name="inline" value="1" />
            <label>
                VVS
                <select name="contractor_id" required>
                    {% for vvs_user in vvs_users %}
                        <option value="{{ vvs_user.id }}" {% if vvs_user.id == contractor.id %}selected{% endif %}>{{ vvs_user.username }}</option>
                    {% endfor %}
                </select>
            </label>
            <label>
                Status
                <select name="status" required>
                    <option value="scheduled" {% if appointment.status.value == 'scheduled' %}selected{% endif %}>Planlagt</option>
                    <option value="informed" {% if appointment.status.value == 'informed' %}selected{% endif %}>Beboer/kunde informeret</option>
                    <option value="completed" {% if appointment.status.value == 'completed' %}selected{% endif %}>Skiftet</option>
                    <option value="closed" {% if appointment.status.value == 'closed' %}selected{% endif %}>Afsluttet</option>
                    <option value="not_home" {% if appointment.status.value == 'not_home' %}selected{% endif %}>Ikke hjemme</option>
                    <option value="needs_reschedule" {% if appointment.status.value == 'needs_reschedule' %}selected{% endif %}>Behov for ny dato</option>
                </select>
            </label>
            <label>Start<input type="time" name="start_raw" value="{{ appointment.starts_at.strftime('%H:%M') }}" required data-duration-start /></label>
            <label>Slut<input type="time" name="end_raw" value="{{ appointment.ends_at.strftime('%H:%M') }}" required data-duration-end /></label>
            <label>Planlagt varighed (min.)<input type="number" name="duration_minutes" min="5" max="480" step="5" value="{{ duration_minutes }}" required data-duration-minutes /></label>
            <label>
                Opgave
                <textarea name="notes" rows="3">{{ appointment.notes or '' }}</textarea>
            </label>
            {% if address %}
                <label>Gammel målernr<input type="text" name="old_meter_no" value="{{ appointment.old_meter_no or '' }}" /></label>
                <label>Ny målernr<input type="text" name="new_meter_no" value="{{ appointment.new_meter_no or '' }}" /></label>
            {% endif %}
            <div class="inline-edit-actions">
                <button type="submit" class="primary-button">Gem</button>
                <button type="button" class="ghost-button" data-inline-edit-close>Skjul</button>
            </div>
        </form>
        {% if availability %}
            <p class="hint">Arbejdsdag: {{ availability.start_time.strftime('%H:%M') }}–{{ availability.end_time.strftime('%H:%M') }}</p>
        {% else %}
            <p class="hint">Ingen arbejdsdag registreret for dagen.</p>
        {% endif %}
    </div>
    {% else %}
    <h1>Rediger opgave</h1>
    {% if address %}
        <p class="hint">{{ address.street }} {{ address.house_no }}, {{ address.zip }} {{ address.city }}</p>
    {% else %}
        <p class="hint">Opgave uden adresse</p>
    {% endif %}
    <form method="post" action="/admin/appointments/{{ appointment.id }}/edit" class="form-grid" data-duration-form>
        <label>
            VVS
            <select name="contractor_id" required>
                {% for vvs_user in vvs_users %}
                    <option value="{{ vvs_user.id }}" {% if vvs_user.id == contractor.id %}selected{% endif %}>{{ vvs_user.username }}</option>
                {% endfor %}
            </select>
        </label>
        <label>
            Status
            <select name="status" required>
                <option value="scheduled" {% if appointment.status.value == 'scheduled' %}selected{% endif %}>Planlagt</option>
                <option value="informed" {% if appointment.status.value == 'informed' %}selected{% endif %}>Beboer/kunde informeret</option>
                <option value="completed" {% if appointment.status.value == 'completed' %}selected{% endif %}>Skiftet</option>
                <option value="closed" {% if appointment.status.value == 'closed' %}selected{% endif %}>Afsluttet</option>
                <option value="not_home" {% if appointment.status.value == 'not_home' %}selected{% endif %}>Ikke hjemme</option>
                <option value="needs_reschedule" {% if appointment.status.value == 'needs_reschedule' %}selected{% endif %}>Behov for ny dato</option>
            </select>
        </label>
        <label>Start<input type="time" name="start_raw" value="{{ appointment.starts_at.strftime('%H:%M') }}" required data-duration-start /></label>
        <label>Slut<input type="time" name="end_raw" value="{{ appointment.ends_at.strftime('%H:%M') }}" required data-duration-end /></label>
        <label>Planlagt varighed (min.)<input type="number" name="duration_minutes" min="5" max="480" step="5" value="{{ duration_minutes }}" required data-duration-minutes /></label>
        <label>
            Opgave
            <textarea name="notes" rows="3">{{ appointment.notes or '' }}</textarea>
        </label>
        {% if address %}
            <label>Gammel målernr<input type="text" name="old_meter_no" value="{{ appointment.old_meter_no or '' }}" /></label>
            <label>Ny målernr<input type="text" name="new_meter_no" value="{{ appointment.new_meter_no or '' }}" /></label>
        {% endif %}
        <button type="submit" class="primary-button">Gem</button>
        <a href="/admin/appointments" class="ghost-button">Tilbage</a>
    </form>
    {% if availability %}
        <p class="hint">Arbejdsdag: {{ availability.start_time.strftime('%H:%M') }}–{{ availability.end_time.strftime('%H:%M') }}</p>
    {% else %}
        <p class="hint">Ingen arbejdsdag registreret for dagen.</p>
    {% endif %}
{% endif %}
